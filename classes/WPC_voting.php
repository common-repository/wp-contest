<?php /*  @PACKAGE WP CONTEST* 	USE: use for save voting *	*/if(!class_exists('WPC_voting')){	class WPC_voting{					/***************	PHASE TWO VOTING	****************/	public function wpc_phase_two_voting(){		global $wpdb;		$table_name = $wpdb->prefix . 'wpc_phase_two_votiong';		$data = $_POST['data'];		$vote = absint( sanitize_text_field($data['total']) );		$entry_id =  absint(sanitize_text_field($data['entry_id']));		$editing_reason =  sanitize_text_field($data['editing_reason']);		$judge_id = get_current_user_id();		if( !check_ajax_referer('voting-nonce', 'security' ) ){			wp_send_json('security failed');			return;		}				if( !current_user_can( 'wpc_judge' )){			wp_send_json(__('Current user can not vote.', 'wpc'));		}		if(!is_int ( $vote )){			wp_send_json(__('vote must be integer.', 'wpc'));		}		if(!is_int ( $entry_id )){			wp_send_json( __('entry_id must be integer.', 'wpc') );		}		if(count(wpc_get_judges()) > 3 ){			wp_send_json( 'Only 3 judges allowed. Unlimited judges allowed on premium version only.');		}		$already_voted = wpc_the_image_voted_by_current_judge_in_phase_two($entry_id, $judge_id);		if(!$already_voted){				//INSERT VOTING			$values = array('entry_id'=> $entry_id, 'judge_id'=> $judge_id,  'vote'=> $vote );			$values_format = array('%d', '%d', '%d');			$insert = wpc_insert_row($table_name, $values, $values_format);			if($insert){				wp_send_json('success');			}else{				wp_send_json('Voting Not Successfull');			}		}else{				//UPDATE VOTING			$values = array('vote' => $vote,'edit_reason' => $editing_reason);			$where  = array( 'entry_id'=> $entry_id, 'judge_id'=> $judge_id );			$values_format = array('%d', '%s');			$where_format = array('%d', '%d');			$update = wpc_update_row($table_name, $values, $where, $values_format, $where_format );			if($update){				wp_send_json('success');			}else{				wp_send_json( __('Voting was not successfull', 'wpc') );			}		}		die();	}}}