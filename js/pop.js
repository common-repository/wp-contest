/*  * 	@PACKAGE WP CONTEST*	USE: entry from multile upload */jQuery(document).ready(function($){	function makeid() {	  var text = "";	  var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";	  for (var i = 0; i < 5; i++)		text += possible.charAt(Math.floor(Math.random() * possible.length));	  return text;	}		// Generate Another upload markup	$(document.body).on('click', '.upload_another', function(){		var html = '';		var additional_fields_html = $( "tr.single_upload_addtional_fields" ).html();		html += '<tr class="single_upload removeable"><td class="remove_upload_field_td"><span class="remove_upload_field"> - </td>' + $( "tr.single_upload" ).html() + '</tr>';		if(additional_fields_html){			var uni_id = makeid();			console.log(uni_id);			 additional_fields_html = additional_fields_html.replace(/__RADIO_FIELD_NAME__/g, uni_id);			html += '<tr class="single_upload_addtional_fields removeable">' + additional_fields_html + '</tr>';		}						$('.pop_entry_table tr:last-child').after(html);		//console.log($html);	});	//Processing Radio field value	$(document.body).on('click', 'input[type="radio"].pop_input', function(event){		var __that = $(this);		var __val = __that.attr('value');		var __id = __that.attr('id');				$('.pop_input_wrap input[type="hidden"]#'+__id).attr('value', __val);	});		$(document.body).on('submit', '#pop_entry_form', function(event){		 		 var allowedSize = popObj.settings.upload_size;		 var contest_id = $('input[name="contest_id"]').val();		 var allowedExt = popObj.settings[contest_id]['allowed_file_ext'];		 var max_num_files = popObj.settings[contest_id]['max_num_files'];		 allowedExt = allowedExt.split(",");		var singleUpload = $(".single_upload");	 		var numbUpload = singleUpload.length;					if(numbUpload > max_num_files){			$('.tos').css('border-bottom', '1px solid red');		   $('.vali_msg').html('<span style="color:red;">You can not upload more than ' + max_num_files + ' at a time</span>');		   event.preventDefault();		   return;	}else{				$('.vali_msg').html('');	}	singleUpload.each(function(){		var that = $(this);       var title = that.find('.pc_entry_form_title').attr('value');       var category = that.find('.pc_entry_form_category').val();	  var  upload = that.find('input[type="file"]');	   var description = that.find('.pc_entry_form_description').val();	   var file = upload.val();	  // if any fields is empty	   if(!title || !category || !description || !file ){		   that.css('border', '1px solid red');		   that.find('.validatin_msg').html('<span style="color:red;">Fillup all Fields.</span>');		   event.preventDefault();		   return;	   }else{		  that.css('border', '0px solid green'); 		  that.find('.validatin_msg').html('');	   }	   				var picsize =  upload[0].files[0].size;		var fileName =  upload[0].files[0].name;		 var extension = fileName.replace(/^.*\./, '');		//if file is grater than allloewd size		if(picsize > allowedSize ){			that.find('.validatin_msg').html('<span style="color:red;">' + fileName + ' is too large to upload </span>');			event.preventDefault();		}else{			that.find('.validatin_msg').html('');		}		//if file extension not matched				if(allowedExt.indexOf(extension)){			that.find('.validatin_msg').html('<span style="color:red;">' + extension + ' file extension is not allowed</span>');			event.preventDefault();		}else{			that.find('.validatin_msg').html('');		}						    });	 // if not accept terms and condition	if(!$('.tos input').is(':checked')){			$('.tos').css('border-bottom', '1px solid red');		   $('.vali_msg').html('<span style="color:red;">Accept Terms And Condition.</span>');		   event.preventDefault();		   return;	}else{		$('.tos').css('border-bottom', '0px solid red');		$('.vali_msg').html('');	}					 	});			 $(document.body).on('click', '.remove_upload_field', function(){		var target = $(this).closest('.single_upload.removeable');		var target_aaddtion_field = $(this).parent().parent().next('tr.single_upload_addtional_fields.removeable');				target_aaddtion_field.fadeOut(300, function(){ 		target_aaddtion_field.remove();				});        target.fadeOut(300, function(){ 		target.remove();				});							});	//Sorting Function 	function getSorted(selector, attrName) {			return $($(selector).toArray().sort(function(a, b){				var aVal = parseInt(a.getAttribute(attrName)),					bVal = parseInt(b.getAttribute(attrName));				return aVal - bVal;			}));	}	function getSortedDesc(selector, attrName) {			return $($(selector).toArray().sort(function(a, b){				var aVal = parseInt(a.getAttribute(attrName)),					bVal = parseInt(b.getAttribute(attrName));				return bVal  - aVal;			}));	}		// judge dashborad order	$(document.body).on('change', '.pop_filter_order', function(){	 var order_value = $(this).val();		if(order_value == 'asc'){			$('tbody.pop_judge_entries_wrap').html(getSorted('tr.pop_dash_view_entry', 'entry_id'));					}				if(order_value == 'desc'){			$('tbody.pop_judge_entries_wrap').html(getSortedDesc('tr.pop_dash_view_entry', 'entry_id'));					}				if(order_value == 'score_desc'){			$('tbody.pop_judge_entries_wrap').html(getSortedDesc('tr.pop_dash_view_entry', 'score'));					}				if(order_value == 'score_asc'){			//console.log(getSorted('tr.pop_dash_view_entry ', 'score'));			$('tbody.pop_judge_entries_wrap').html(getSorted('tr.pop_dash_view_entry', 'score'));								}								});	$(document.body).on('click', '.hide_out_of_contest', function(){		if(!$(this).is(':checked')){			$('tr.pop_dash_view_entry.out_of_contest').removeClass('hide_entery');		}else{			$('tr.pop_dash_view_entry.out_of_contest').addClass('hide_entery');		}		});		$(document.body).on('click', '.pop_export_csv', function(){	$("table.pop_table_hidden").tableToCSV();	});		$(document.body).on('click', '#popsearchformtype', function(){		if($(this).prop("checked")){		var selected_form = $(this).attr('value');		$('.formOne, .formTwo').css('display', 'none');		$('.'+selected_form).css('display', 'block');		}	});	// filter by category 	/*$(document.body).on('change', '.pop_cat_select' ,function(){    var showAll = true;    $('tr._pop_single_entry').hide();    $('option.pop_single_cat').each(function () {        if ($(this)[0].selected) {			var category = $(this).attr('value');			showAll = false;			if(category != '0'){                        $('tr._pop_single_entry[category="' + category + '"]').show();			}else{				$('tr._pop_single_entry').show();			}        }    });    if(showAll){        $('tr').show();    }}); */function removeURLParameter(url, parameter) {    //prefer to use l.search if you have a location/link object    var urlparts= url.split('?');       if (urlparts.length>=2) {        var prefix= encodeURIComponent(parameter)+'=';        var pars= urlparts[1].split(/[&;]/g);        //reverse iteration as may be destructive        for (var i= pars.length; i-- > 0;) {                //idiom for string.startsWith            if (pars[i].lastIndexOf(prefix, 0) !== -1) {                  pars.splice(i, 1);            }        }        url= urlparts[0]+'?'+pars.join('&');        return url;    } else {        return url;    }}$(document.body).on('change', '.pop_cat_select' ,function(){	$('option.pop_single_cat').each(function () {        if ($(this)[0].selected) {			var category = $(this).attr('value');			var url      = window.location.href;			url = removeURLParameter(url, 'pop_page');			url = removeURLParameter(url, 'pop_category');			var category =  encodeURIComponent(category);						window.location.replace(removeURLParameter(url, 'pop_page') + '?pop_category=' + category);        }    });});var popExportAll = function(formdata, action){				$.ajax({			url:popObj.url,			type:'POST',			data:{				action: action,				data: formdata,				security:popObj.security,							},			timeout: 99999999999,			success:function(response){					$('.pop_export_all_content').css('display', 'none');					$(".pop_export_all_msg").html(response);					$(".exporting").css('display', 'none');					if(response != 'failed'){						$("table.pop_all_export_table").tableToCSV();					}							},			error:function(){				alert('Form was not submitted successfully');			}								});			};$(document.body).on('click', '.pop_export_all' ,function(){$('.pop_export_all_content').css('display', 'inline-block');});$(document.body).on('click', '.exportAll' ,function(){$(".exporting").css('display', 'block');var ContestID = $('.pop_export_all').attr('contest_id');if($('.pop_single_cat1:selected')){	 var category = $('.pop_single_cat1:selected').attr('value');}else{	 var category = 'all';}var formdata = {				 'contest_id':ContestID,				 'category':category,											 };		console.log(category);			 popExportAll(formdata, 'wpc_export_all');});		});