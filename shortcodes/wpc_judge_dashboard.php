<?php /*  * 	@PACKAGE WP CONTEST*	USE: judge dashborad shortcode*/if(!function_exists('wpc_judge_dashboard')){function wpc_judge_dashboard($atts, $content = null){	extract(shortcode_atts(array(			'contest_id'=>'0',				),$atts,'wpc_judge_dash'));		$output ='';	$contest_id = sanitize_text_field( $contest_id );	if( $contest_id != '0' ){		if(!is_user_logged_in()){		return 'Sorry, only judges can see this information. If you’re a judge please <a href="'.wp_login_url(get_the_permalink()).'">login</a> and return to this page.';	}	$current_user = wp_get_current_user();		$all_contest_id = wpc_get_all_contest_id();	if(!$all_contest_id){		return 'No Contest Found';	}	$all_entries_id = wpc_get_all_paid_entry_id_by_contest_id($contest_id);		$WPC_contest_settings = new WPC_contest_settings($contest_id);	$settings = $WPC_contest_settings->WPC_the_contest_settings();	$category_options = $settings['category_options'];	$current_category = isset($_GET['pop_category']) ? $_GET['pop_category'] : 'all';	if(count($category_options)){			$categories_input = '<select class="pop_cat_select">								<option '.($current_category == 'all' ? 'selected' : '').' value="all" class="pop_single_cat" >'.__('All', 'wpc').'</option>							';		$pop_cat_list = '<select class="pop_cat_list">								<option  value="all" class="pop_single_cat1" >'.__('All', 'wpc').'</option>							';				foreach($category_options as $opt){			$categories_input .= '<option  '.($current_category == $opt ? 'selected' : '').' class="pop_single_cat" value="'.$opt.'">'.$opt.'</option>';			$pop_cat_list .= '<option   class="pop_single_cat1" value="'.$opt.'">'.$opt.'</option>';		}		$categories_input .= '</select>';		$pop_cat_list .= '</select>';	}else{		$categories_input = '';		$pop_cat_list = '';	}	if(!count($all_contest_id)){		return 'No Contest Found';	}		if(!in_array( $contest_id, $all_contest_id)){		 return 'No Contest Found';	}	if($settings['contest_on_off'] !== 'on'){		return 'This Contest is Not Enable';	}	if(!in_array('wpc_judge', $current_user->roles)){		return 'Sorry, only judges can see this information. If you’re a judge please <a href="'.wp_login_url(get_the_permalink()).'">login</a> and return to this page.';	}				if(!$all_entries_id){		return 'No entry Found To Vote';	}	$output .= '<h1 class="contest_title">'.wpc_get_contest_title($contest_id).'</h1>				<div class="pop_filter_wrap">					Order By					<select name="" id="pop_filter_order" class="pop_filter_order">						<option value="desc">Entry ID Descending</option>						<option value="asc">Entry ID Ascending</option>						<option value="score_asc">Score Ascending</option>						<option value="score_desc">Score Descending</option>					</select>					<input class="hide_out_of_contest" type="checkbox" /> Hide images that did not pass the elimination round					<div class="filter_by_category" style="margin-bottom:20px;">						<h6>Filter By Category</h6>						<div class="categories_holder">							'.$categories_input.'						</div>					</div>				</div>				';				/*$entry_values = wpc_get_entry($current_display_entry_id);		$entry_meta = unserialize( $entry_values['entry_meta'] );		$img_src = wpc_upload_dir_url().$entry_meta['image'];		$already_voted = wpc_the_image_voted_by_current_judge_in_phase_two($current_display_entry_id, $current_user->ID);*/	$output .= '<table class="judge_dashboard_table" width="100%">				  <tr>					<th>Submission ID</th>					<th>Photo</th> 					<th>Submitted by</th>					<th>Submitted on</th>					<th>Status</th>					<th>Score</th>				  </tr> <tbody class="pop_judge_entries_wrap">';	$table_hidden = '<table class="pop_table_hidden" >				  <tr>					<th>Submission ID</th>					<th>Submitted By</th> 					<th>Description</th>					<th>Photo Title</th>					<th>Category</th>					<th>Score</th>					<th>Submitted On</th>					<th>Photo URL</th>				  </tr>';	$current_filtered_category = wpc_filter_current_category_entries($all_entries_id, $current_category);		//pagination class init 	$currentPage = !empty($_GET['pop_page']) ? (int) $_GET['pop_page'] : 1; 	$allItems = $current_filtered_category;	$pl = new WPCPageLister($allItems, $currentPage);	$pageList = $pl->makePageList();	$currentItems = $pl->getCurrentItems();			foreach($currentItems as $entry_id){		$entry_values = wpc_get_entry($entry_id);		$entry_meta = unserialize( $entry_values['entry_meta'] );		$img_src = wpc_upload_dir_url().$entry_meta['image'];		if( wpc_get_score($entry_id) && ( wpc_get_score($entry_id) !== 0 ) ){			$score = wpc_get_score($entry_id);			$scoreAttr = $score;		}else{			$score = "Not Scored Yet";			$scoreAttr = 0;		}		if( wpc_entries_eligible_for_phase_two($contest_id) ){			$photos_of_phase_two = wpc_entries_eligible_for_phase_two($contest_id);		}else{			$photos_of_phase_two = array();		}		if(in_array($entry_id, $photos_of_phase_two)){			$status = 'Voting Round';		}elseif(wpc_if_out_of_contest($entry_id)){			$status = 'Out Of Contest';		}else{			$status = 'Elimination Round';		}		if($status == 'Out Of Contest'){ $status_class=" out_of_contest "; }else{ $status_class= ''; }		// echo '<pre>';		// var_dump($entry_values);		// echo '</pre>';		$output .=	 '<tr category="'.str_replace(" ", "", $entry_meta['category']).'" class="_pop_single_entry pop_dash_view_entry'.$status_class.'" entry_id="'.$entry_id.'" score="'.$scoreAttr.'">					<td>'.$entry_id.'</td>					<td><img src="'.esc_url_raw( $img_src ).'" alt="" class="entry_img" /></td> 					<td>'. get_user_by('id', $entry_values['user_id'])->display_name.'</td>					<td>'.$entry_values['entry_time'].'</td>					<td>'.$status.'</td>					<td>'.$score.'</td>				  </tr>';		$table_hidden .=	 '<tr>					<td>'.$entry_id.'</td>					<td>'. get_user_by('id', $entry_values['user_id'])->display_name.'</td>					<td>'.$entry_meta['description'].'</td>					<td>'.$entry_meta['title'].'</td>					<td>'.$entry_meta['category'].'</td>					<td>'.$score.'</td>					<td>'.$entry_values['entry_time'].'</td>					<td>'.esc_url_raw( $img_src ).'</td> 														  </tr>';			}		$table_hidden .=	'</tbody></table>';		$output .=	'</tbody></table><button class="pop_export_csv" type="button">EXPORT THIS PAGE</button>'.$table_hidden;			$output .= '<div    class="pop_export_all_wrap">					<div class="pop_export_all_msg"></div>					<button contest_id="'.$contest_id.'" class="pop_export_all">EXPORT ALL PAGES</button>					<div  style="display:none;" class="pop_export_all_content">						<div class="exporting">Exporting</div>						Choose Category <br />'.$pop_cat_list.'						<br />						<button class="exportAll">EXPORT ALL</button>					</div>				</div>';	$total_pages = count($pageList) - 2;	if($total_pages > 1){	$total_num = count($allItems);	$output .= '<div class="pop_pagination">';	$output .= wpc_paginate_function(10, $currentPage, $total_num, $total_pages, $contest_id);	$output .= '</div>';	}		}		return $output;}}